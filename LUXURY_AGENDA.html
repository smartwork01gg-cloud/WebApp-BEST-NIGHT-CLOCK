<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Agenda Luxury 2026 - Ultimate 3D Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Dancing+Script:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --desk: #0a0a0a; --leather: #1c130d; --gold: #b89352;
            --paper: #fcfaf2; --ink: #1a1a1a;
            --line-color: rgba(0, 0, 0, 0.12);
            --margin-color: rgba(220, 20, 60, 0.3);
            --shadow: rgba(0,0,0,0.5);
        }
        .theme-dark {
            --paper: #1a1a1a; --ink: #e0d0b0;
            --line-color: rgba(184, 147, 82, 0.15);
            --margin-color: rgba(184, 147, 82, 0.4);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; background: var(--desk);
            font-family: 'Cormorant Garamond', serif;
            height: 100vh; display: flex; overflow: hidden;
            justify-content: center; align-items: center;
            perspective: 2500px;
        }

        /* UI CONTROLS */
        .side-controls { position: fixed; display: flex; gap: 8px; z-index: 9999; }
        @media (min-width: 769px) {
            .side-controls { flex-direction: column; top: 50%; transform: translateY(-50%); }
            .controls-left { left: 15px; } .controls-right { right: 15px; }
        }
        @media (max-width: 768px) {
            .side-controls { flex-direction: row; top: 5px; left: 50%; transform: translateX(-50%); width: 98%; justify-content: center; flex-wrap: wrap; }
            .controls-right { top: 45px; }
            .btn-round { width: 34px !important; height: 34px !important; font-size: 0.9rem !important; }
            .select-luxury { width: 60px !important; font-size: 0.5rem !important; height: 28px !important; }
        }

        .btn-round {
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(20, 20, 20, 0.9); border: 1px solid var(--gold);
            color: var(--gold); cursor: pointer; display: flex;
            align-items: center; justify-content: center; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); backdrop-filter: blur(8px);
        }
        .btn-round.active { background: var(--gold); color: white; }
        .select-luxury {
            width: 90px; height: 35px; border-radius: 15px;
            background: rgba(20, 20, 20, 0.9); border: 1px solid var(--gold);
            color: var(--gold); cursor: pointer; font-size: 0.65rem; text-transform: uppercase; outline: none;
        }

        /* BOOK ENGINE 3D */
        #book { 
            width: 90vw; height: 85vh; position: relative; 
            transform-style: preserve-3d;
            max-width: 1200px;
        }
        
        @media (max-width: 768px) {
            #book { width: 100vw; height: 100vh; }
        }
        
        .page { 
            position: absolute; background: var(--paper); color: var(--ink); 
            padding: 25px 35px; display: flex; flex-direction: column; 
            backface-visibility: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.05), 5px 5px 20px var(--shadow);
            overflow: hidden;
        }

        /* Desktop Layout */
        @media (min-width: 769px) {
            .page { width: 50%; height: 100%; top: 0; }
            .page.left { left: 0; border-radius: 15px 0 0 15px; z-index: 2; }
            .page.right { right: 0; border-radius: 0 15px 15px 0; z-index: 1; border-left: 1px solid rgba(0,0,0,0.1); }
        }

        /* Mobile Layout */
        @media (max-width: 768px) {
            .page { width: 100%; height: 100%; top: 0; left: 0; border-radius: 0; padding: 100px 20px 20px 20px; }
            .page.left { display: none; }
        }

        /* Animazione 3D Flip completa */
        .flip-container {
            position: absolute;
            width: 50%;
            height: 100%;
            top: 0;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.645, 0.045, 0.355, 1);
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            .flip-container { width: 100%; left: 0; }
        }

        .flip-container .flip-front,
        .flip-container .flip-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: var(--paper);
            color: var(--ink);
            padding: 25px 35px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.05), 5px 5px 20px var(--shadow);
        }
        
        @media (max-width: 768px) {
            .flip-container .flip-front,
            .flip-container .flip-back {
                padding: 100px 20px 20px 20px;
                border-radius: 0;
            }
        }

        .flip-container .flip-back {
            transform: rotateY(180deg);
        }

        @media (min-width: 769px) {
            .flip-container.flip-right {
                left: 50%;
                transform-origin: left center;
            }
            .flip-container.flip-right .flip-front {
                border-radius: 0 15px 15px 0;
                border-left: 1px solid rgba(0,0,0,0.1);
            }
            .flip-container.flip-right .flip-back {
                border-radius: 15px 0 0 15px;
            }
            .flip-container.flip-left {
                left: 0;
                transform-origin: right center;
            }
            .flip-container.flip-left .flip-front {
                border-radius: 15px 0 0 15px;
            }
            .flip-container.flip-left .flip-back {
                border-radius: 0 15px 15px 0;
                border-left: 1px solid rgba(0,0,0,0.1);
            }
        }

        .flip-container.flipping-forward {
            transform: rotateY(-180deg);
        }

        .flip-container.flipping-backward {
            transform: rotateY(180deg);
        }

        /* NAVIGATION */
        .nav-zone {
            position: fixed; top: 0; width: 70px; height: 100%;
            z-index: 8000; cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: var(--gold); font-size: 2.5rem; 
            background: rgba(184, 147, 82, 0.08);
            backdrop-filter: blur(5px);
            opacity: 0.4;
            transition: all 0.3s;
            border: 1px solid rgba(184, 147, 82, 0.1);
        }
        .nav-zone:hover { 
            opacity: 1; 
            background: rgba(184, 147, 82, 0.15); 
            transform: scaleY(1.05);
        }
        .nav-left { 
            left: 0; 
            border-radius: 0 20px 20px 0;
            border-left: none;
        }
        .nav-right { 
            right: 0; 
            border-radius: 20px 0 0 20px;
            border-right: none;
        }
        
        @media (max-width: 768px) {
            .nav-zone { 
                width: 50px; 
                font-size: 2rem;
                opacity: 0.6;
            }
        }

        /* EDITOR & GRAPHICS */
        .editor {
            height: 100%; background-image: linear-gradient(transparent 31px, var(--line-color) 32px);
            background-size: 100% 32px; line-height: 32px; outline: none;
            padding-left: 15px; border-left: 2px solid var(--margin-color);
            white-space: pre-wrap; position: relative; z-index: 1; overflow-y: auto;
        }
        .draw-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        body.pen-active .draw-layer { pointer-events: auto; cursor: crosshair; }

        .page-header { border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 5px; margin-bottom: 15px;}
        .header-day-num { font-family: 'Playfair Display'; font-size: 4rem; color: var(--gold); font-weight: 700; line-height: 0.8; }

        /* LUXURY CALENDAR */
        #calendar-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); 
            z-index: 10000; display: none; justify-content: center; align-items: center; padding: 20px;
            backdrop-filter: blur(15px);
        }
        .cal-container {
            background: #111; border: 1px solid var(--gold); width: 100%; max-width: 1100px;
            max-height: 90vh; overflow-y: auto; padding: 40px; border-radius: 8px;
            box-shadow: 0 0 60px rgba(184, 147, 82, 0.3);
        }
        .cal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 35px; }
        .cal-month-title { color: var(--gold); font-family: 'Playfair Display'; border-bottom: 1px solid #333; margin-bottom: 12px; padding-bottom: 5px; text-transform: uppercase; letter-spacing: 3px; font-size: 1.1rem; }
        .cal-days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .cal-day {
            background: #1a1a1a; border: 1px solid #222; color: #fff; padding: 10px 0;
            cursor: pointer; font-size: 0.85rem; transition: 0.3s; border-radius: 4px; text-align: center;
        }
        .cal-day:hover { background: var(--gold); color: #000; font-weight: bold; transform: translateY(-2px); }
        .cal-day.today { border: 1px solid var(--gold); color: var(--gold); box-shadow: inset 0 0 10px rgba(184, 147, 82, 0.2); }

        /* VIRTUAL KEYBOARD */
        #virtual-keyboard {
            position: fixed; bottom: -100%; left: 0; width: 100%; 
            background: #000; padding: 10px; z-index: 10001; 
            transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border-top: 2px solid var(--gold);
        }
        .kb-row { display: flex; justify-content: center; gap: 5px; margin-bottom: 6px; }
        .kb-key {
            background: #222; color: #fff; border: 1px solid #333; 
            border-radius: 8px; height: 50px; flex: 1; max-width: 65px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-family: 'Inter'; font-size: 1.1rem; transition: 0.1s;
        }
        .kb-key:active { background: var(--gold); color: #000; transform: scale(0.95); }
        .key-wide { flex: 2; max-width: none; }
        .key-gold { background: var(--gold) !important; color: #000 !important; font-weight: bold; }
    </style>
</head>
<body class="theme-light">

    <div class="nav-zone nav-left" onclick="turnPage('prev')">‚ùÆ</div>
    <div class="nav-zone nav-right" onclick="turnPage('next')">‚ùØ</div>

    <div class="side-controls controls-left">
        <button class="btn-round" onclick="toggleFullScreen()">‚õ∂</button>
        <button class="btn-round" onclick="goDirectlyToToday()">üéØ</button>
        <button class="btn-round" onclick="toggleTheme()">‚óë</button>
        <button class="btn-round" onclick="toggleCalendar()">üìÖ</button>
        <button class="btn-round" onclick="exportData()">üíæ</button>
        <button class="btn-round" onclick="document.getElementById('importFile').click()">üìÇ</button>
        <input type="file" id="importFile" hidden onchange="importData(event)">
    </div>

    <div class="side-controls controls-right">
        <button class="btn-round" onclick="toggleKb()">‚å®</button>
        <button class="btn-round" id="pen-toggle" onclick="togglePen()">‚úé</button>
        <button class="btn-round" id="eraser-toggle" onclick="toggleEraser()">üßπ</button>
        <div class="btn-round" style="overflow:hidden;"><input type="color" id="inkColor" onchange="updatePenSettings()" style="transform:scale(2); cursor:pointer;"></div>
        <select id="penSize" class="select-luxury" onchange="updatePenSettings()">
            <option value="2">Fine</option>
            <option value="5" selected>Med</option>
            <option value="12">Big</option>
        </select>
        <button class="btn-round" onclick="clearDraw()">‚å´</button>
        <select id="fontPicker" class="select-luxury" onchange="changeFont(this.value)">
            <option value="'Dancing Script'">Corsivo</option>
            <option value="'Inter'">Moderno</option>
            <option value="'Playfair Display'">Classico</option>
        </select>
        <select id="fontSizePicker" class="select-luxury" onchange="changeFontSize(this.value)">
            <option value="1.1rem">Small</option>
            <option value="1.3rem" selected>Medium</option>
            <option value="1.6rem">Large</option>
        </select>
    </div>

    <main id="book">
        <div class="page left" id="p-left"></div>
        <div class="page right" id="p-right"></div>
    </main>

    <div id="virtual-keyboard">
        <div id="kb-container"></div>
    </div>

    <div id="calendar-overlay" onclick="toggleCalendar()">
        <div class="cal-container" onclick="event.stopPropagation()">
            <h2 style="color:var(--gold); text-align:center; font-family:'Playfair Display'; letter-spacing:8px; margin-top:0;">2026 LUXURY COLLECTOR</h2>
            <div class="cal-grid" id="cal-grid"></div>
        </div>
    </div>

<script>
    let state = { d: 1, dark: false, font: "'Dancing Script'", fSize: "1.3rem", content: {}, draws: {}, penColor: "#1a1a1a", penWidth: "5" };
    let isPenActive = false, isEraserActive = false, focusedEditor = null, isKbOpen = false, isFlipping = false;
    let kbMode = 'lower';

    const keys = {
        lower: [['q','w','e','r','t','y','u','i','o','p'],['a','s','d','f','g','h','j','k','l'],['SHIFT','z','x','c','v','b','n','m','BKSP'],['123','SPACE','ENTER','‚óÄ','‚ñ∂','CHIUDI']],
        upper: [['Q','W','E','R','T','Y','U','I','O','P'],['A','S','D','F','G','H','J','K','L'],['shift','Z','X','C','V','B','N','M','BKSP'],['123','SPACE','ENTER','‚óÄ','‚ñ∂','CHIUDI']],
        symbols: [['1','2','3','4','5','6','7','8','9','0'],['@','#','‚Ç¨','&','*','-','+','(',')','/'],['ABC','.',',','?','!',"'",'"',':',';','BKSP'],['123','SPACE','ENTER','‚óÄ','‚ñ∂','CHIUDI']]
    };

    window.onload = () => {
        const saved = localStorage.getItem('agenda_luxury_v26_3d_final_v3');
        if (saved) state = JSON.parse(saved); else goDirectlyToToday();
        applyTheme(); renderPages(); buildCalendar(); renderKeyboard();
        
        window.addEventListener('wheel', (e) => { 
            if(!isFlipping && !isPenActive && !isEraserActive) {
                e.preventDefault();
                e.deltaY > 0 ? turnPage('next') : turnPage('prev'); 
            }
        }, { passive: false });
    };

    function getPageContentHTML(day) {
        if (day < 1 || day > 365) return `<div style="display:flex; height:100%; align-items:center; justify-content:center; opacity:0.1;"><h3>FINE ANNO</h3></div>`;
        const date = new Date(2026, 0, day);
        return `
            <div class="page-header">
                <div>
                    <h3 style="margin:0; color:var(--gold); text-transform:uppercase; font-size:0.75rem; letter-spacing:2px;">${date.toLocaleDateString('it-IT', {month:'long'})} 2026</h3>
                    <h2 style="margin:0; font-family:'Playfair Display'; font-size:1.5rem; font-style:italic;">${date.toLocaleDateString('it-IT', {weekday:'long'})}</h2>
                </div>
                <div class="header-day-num">${date.getDate()}</div>
            </div>
            <div style="position:relative; flex:1; display:flex; flex-direction:column;">
                <div class="editor" contenteditable="true" id="edit-${day}" 
                     onfocus="focusedEditor=this"
                     oninput="state.content[${day}] = this.innerHTML; saveToLocal();"
                     style="font-family: ${state.font}; font-size: ${state.fSize}">${state.content[day] || ""}</div>
                <canvas id="canv-${day}" class="draw-layer"></canvas>
            </div>`;
    }

    function renderPages() {
        const isMobile = window.innerWidth <= 768;
        const pRight = document.getElementById('p-right');
        const pLeft = document.getElementById('p-left');
        
        pRight.innerHTML = getPageContentHTML(isMobile ? state.d : state.d + 1);
        
        if(!isMobile) {
            pLeft.innerHTML = getPageContentHTML(state.d);
        }
        
        setTimeout(() => { 
            initCanvas(state.d); 
            if(!isMobile) initCanvas(state.d + 1); 
        }, 50);
    }

    function turnPage(dir) {
        if(isFlipping || isPenActive || isEraserActive) return;
        
        const isMobile = window.innerWidth <= 768;
        const step = isMobile ? 1 : 2;

        if (dir === 'next' && state.d + step <= 365) {
            performFlipAnimation(dir, isMobile);
            setTimeout(() => {
                state.d += step;
                renderPages();
                saveToLocal();
            }, 1000);
        } else if (dir === 'prev' && state.d - step >= 1) {
            performFlipAnimation(dir, isMobile);
            setTimeout(() => {
                state.d -= step;
                renderPages();
                saveToLocal();
            }, 1000);
        }
    }

    function performFlipAnimation(direction, isMobile) {
        isFlipping = true;
        const book = document.getElementById('book');
        
        // Crea container per animazione
        const flipContainer = document.createElement('div');
        flipContainer.className = 'flip-container';
        
        if(direction === 'next') {
            flipContainer.classList.add('flip-right');
        } else {
            flipContainer.classList.add('flip-left');
        }
        
        // Crea fronte e retro
        const flipFront = document.createElement('div');
        flipFront.className = 'flip-front';
        const flipBack = document.createElement('div');
        flipBack.className = 'flip-back';
        
        // Imposta contenuto
        if(direction === 'next') {
            // Fronte mostra la pagina corrente che sta girando
            flipFront.innerHTML = getPageContentHTML(isMobile ? state.d : state.d + 1);
            // Retro mostra la nuova pagina
            flipBack.innerHTML = getPageContentHTML(isMobile ? state.d + (isMobile ? 1 : 2) : state.d);
        } else {
            // Per andare indietro
            flipFront.innerHTML = getPageContentHTML(state.d);
            flipBack.innerHTML = getPageContentHTML(isMobile ? state.d - 1 : state.d - 1);
        }
        
        flipContainer.appendChild(flipFront);
        flipContainer.appendChild(flipBack);
        book.appendChild(flipContainer);
        
        // Forza reflow
        flipContainer.offsetHeight;
        
        // Avvia animazione
        setTimeout(() => {
            if(direction === 'next') {
                flipContainer.classList.add('flipping-forward');
            } else {
                flipContainer.classList.add('flipping-backward');
            }
        }, 10);
        
        // Rimuovi dopo animazione
        setTimeout(() => {
            flipContainer.remove();
            isFlipping = false;
        }, 1050);
    }

    function buildCalendar() {
        const grid = document.getElementById('cal-grid');
        const months = ["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
        
        months.forEach((m, mi) => {
            const mDiv = document.createElement('div');
            mDiv.innerHTML = `<div class="cal-month-title">${m}</div>`;
            const daysGrid = document.createElement('div');
            daysGrid.className = 'cal-days-grid';
            
            let daysInMonth = new Date(2026, mi + 1, 0).getDate();
            for(let d=1; d<=daysInMonth; d++) {
                const btn = document.createElement('div');
                btn.className = 'cal-day';
                const today = new Date();
                if(today.getFullYear() === 2026 && today.getMonth() === mi && today.getDate() === d) btn.classList.add('today');
                btn.innerText = d;
                btn.onclick = () => {
                    const targetDate = new Date(2026, mi, d);
                    const startOfYear = new Date(2026, 0, 1);
                    state.d = Math.round((targetDate - startOfYear) / 86400000) + 1;
                    renderPages();
                    toggleCalendar();
                };
                daysGrid.appendChild(btn);
            }
            mDiv.appendChild(daysGrid);
            grid.appendChild(mDiv);
        });
    }

    function initCanvas(day) {
        const canvas = document.getElementById(`canv-${day}`);
        if(!canvas) return;
        const ctx = canvas.getContext('2d'), container = canvas.parentElement;
        canvas.width = container.offsetWidth; canvas.height = container.offsetHeight;
        if(state.draws[day]) { const img = new Image(); img.onload = () => ctx.drawImage(img, 0, 0); img.src = state.draws[day]; }

        let drawing = false;
        const getCoords = (e) => {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        };

        canvas.onmousedown = canvas.ontouchstart = (e) => { 
            if(!isPenActive && !isEraserActive) return;
            e.preventDefault();
            drawing = true; ctx.beginPath(); const p = getCoords(e); ctx.moveTo(p.x, p.y); 
        };
        canvas.onmousemove = canvas.ontouchmove = (e) => {
            if(!drawing) return; 
            e.preventDefault();
            const p = getCoords(e);
            if(isEraserActive) ctx.clearRect(p.x-15, p.y-15, 30, 30);
            else { 
                ctx.lineWidth = state.penWidth; ctx.lineCap = 'round'; 
                ctx.strokeStyle = state.penColor; ctx.lineTo(p.x, p.y); ctx.stroke(); 
            }
        };
        canvas.onmouseup = canvas.ontouchend = (e) => { 
            if(drawing) { 
                e.preventDefault();
                drawing = false; 
                state.draws[day] = canvas.toDataURL(); 
                saveToLocal(); 
            } 
        };
    }

    // UTILITIES
    function renderKeyboard() {
        const container = document.getElementById('kb-container'); container.innerHTML = '';
        keys[kbMode].forEach(row => {
            const rowDiv = document.createElement('div'); rowDiv.className = 'kb-row';
            row.forEach(key => {
                const btn = document.createElement('div'); btn.className = 'kb-key';
                if(['SHIFT','shift','BKSP','123','ABC','ENTER','CHIUDI'].includes(key)) btn.classList.add('key-wide');
                if(key === 'SPACE') btn.style.flex = "4"; if(key === 'CHIUDI') btn.classList.add('key-gold');
                btn.innerText = key; btn.onclick = (e) => { e.preventDefault(); handleKeyPress(key); };
                rowDiv.appendChild(btn);
            });
            container.appendChild(rowDiv);
        });
    }

    function handleKeyPress(key) {
        if(!focusedEditor) return; focusedEditor.focus();
        switch(key) {
            case 'CHIUDI': toggleKb(); break;
            case 'SHIFT': kbMode = 'upper'; renderKeyboard(); break;
            case 'shift': kbMode = 'lower'; renderKeyboard(); break;
            case '123': kbMode = 'symbols'; renderKeyboard(); break;
            case 'ABC': kbMode = 'lower'; renderKeyboard(); break;
            case 'BKSP': document.execCommand('delete', false); break;
            case 'ENTER': document.execCommand('insertLineBreak', false); break;
            case 'SPACE': document.execCommand('insertText', false, ' '); break;
            case '‚óÄ': window.getSelection().modify("move", "backward", "character"); break;
            case '‚ñ∂': window.getSelection().modify("move", "forward", "character"); break;
            default: 
                document.execCommand('insertText', false, key);
                if(kbMode === 'upper') { kbMode = 'lower'; renderKeyboard(); }
        }
        state.content[focusedEditor.id.split('-')[1]] = focusedEditor.innerHTML;
        saveToLocal();
    }

    function toggleKb() { isKbOpen = !isKbOpen; document.getElementById('virtual-keyboard').style.bottom = isKbOpen ? '0' : '-100%'; }
    function togglePen() { isPenActive = !isPenActive; isEraserActive = false; updateUI(); }
    function toggleEraser() { isEraserActive = !isEraserActive; isPenActive = false; updateUI(); }
    function updateUI() {
        document.body.classList.toggle('pen-active', isPenActive || isEraserActive);
        document.getElementById('pen-toggle').classList.toggle('active', isPenActive);
        document.getElementById('eraser-toggle').classList.toggle('active', isEraserActive);
    }
    function clearDraw() {
        const id = focusedEditor ? focusedEditor.id.split('-')[1] : state.d;
        const c = document.getElementById(`canv-${id}`);
        if(c) { c.getContext('2d').clearRect(0,0,c.width,c.height); delete state.draws[id]; saveToLocal(); }
    }
    function saveToLocal() { localStorage.setItem('agenda_luxury_v26_3d_final_v3', JSON.stringify(state)); }
    function applyTheme() { document.body.className = state.dark ? 'theme-dark' : 'theme-light'; }
    function toggleTheme() { state.dark = !state.dark; applyTheme(); saveToLocal(); }
    function changeFont(f) { state.font = f; renderPages(); saveToLocal(); }
    function changeFontSize(s) { state.fSize = s; renderPages(); saveToLocal(); }
    function updatePenSettings() { state.penColor = document.getElementById('inkColor').value; state.penWidth = document.getElementById('penSize').value; }
    function toggleCalendar() { const c = document.getElementById('calendar-overlay'); c.style.display = (c.style.display==='flex')?'none':'flex'; }
    function goDirectlyToToday() { 
        const now = new Date(); const start = new Date(2026, 0, 1);
        state.d = Math.max(1, Math.floor((now - start) / 86400000) + 1);
        renderPages(); 
    }
    function exportData() { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(state)], {type:'application/json'})); a.download = `agenda_luxury_2026.json`; a.click(); }
    function importData(e) { const r = new FileReader(); r.onload = (ev) => { state = JSON.parse(ev.target.result); renderPages(); applyTheme(); }; r.readAsText(e.target.files[0]); }
    function toggleFullScreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
</script>
</body>
</html>
